Сервис для обработки направленных ациклических графов (DAG)

Предоставляется API-интерфейс для сохранения и визуализации направленных ациклических графов с использованием PostgreSQL в качестве СУБД.

Возможности сервиса:

    Загрузка графа по заданному набору вершин и связей

    Извлечение графа по его идентификатору в виде списка вершин и ребер

    Получение списка смежности графа по ID

    Получение обратного списка смежности графа

    Удаление указанной вершины по ID графа и имени вершины

Технологический стек

    Python версии 3.11

    FastAPI

    PostgreSQL 13

    SQLAlchemy

    Docker и docker compose — для контейнеризации и оркестрации

Архитектура решения

    При инициализации сервис устанавливает соединение с PostgreSQL и создает необходимые таблицы: graphs, nodes, edges.

    При добавлении графа выполняются проверки на наличие хотя бы одной вершины и отсутствие циклов с использованием итеративного DFS. Также осуществляется проверка на уникальность узлов и ребер с помощью ограничений на уровне БД.

    Валидация входных данных осуществляется при помощи Pydantic.

    Работа с БД построена на ORM SQLAlchemy.

    Для корректной последовательности запуска компонентов применяются механизмы health-check и depends в Docker Compose.

Запуск с использованием Docker Compose

    Убедитесь, что на вашем устройстве установлен Docker и Docker Compose.

    Клонируйте репозиторий проекта:

git clone https://github.com/kisorimaD/fastapi-dag-service.git
cd fastapi-dag-service

    Запустите проект через Docker Compose:

docker compose up

API будет доступно по адресу http://localhost:8080.
Тестирование (через Docker Compose)

    Запустите основной сервис.

    Для выполнения тестов выполните:

docker compose exec dag-api pytest tests/

    Для исключения долгих тестов можно добавить флаг -k "not slow"

API-интерфейс

FastAPI автоматически создает документацию, доступную по адресу /docs.
POST /api/graph

Добавляет новый граф в систему.

{
    "nodes": [
        {"name": "a"},
        {"name": "b"},
        {"name": "c"}
    ],
    "edges": [
        {"source": "a", "target": "b"},
        {"source": "b", "target": "c"}
    ]
}

GET /api/graph/{graph_id}

Возвращает граф с указанным идентификатором (список вершин и ребер).

{
    "nodes": [
        {"name": "a"},
        {"name": "b"},
        {"name": "c"}
    ],
    "edges": [
        {"source": "a", "target": "b"},
        {"source": "b", "target": "c"}
    ]
}

GET /api/graph/{graph_id}/adjacency_list

Отдает представление графа в виде списка смежности.

{
    "adjacency_list": {
        "a": ["b"],
        "b": ["c"],
        "c": []
    }
}

GET /api/graph/{graph_id}/reverse_adjacency_list

Предоставляет транспонированный список смежности по ID графа.

{
    "reverse_adjacency_list": {
        "a": [],
        "b": ["a"],
        "c": ["b"]
    }
}

DELETE /api/graph/{graph_id}/node/{node_name}

Удаляет указанную вершину из графа. При успешном удалении возвращается статус 204 No Content.
